<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Radio Garden Clone</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://unpkg.com/globe.gl"></script>
    <style>
        body { margin: 0; background: #000; color: white; font-family: sans-serif; overflow: hidden; }
        
        /* –ü–∞–Ω–µ–ª—å —Å–≤–µ—Ä—Ö—É */
        #ui-top { position: fixed; top: 0; width: 100%; height: 60px; background: rgba(0,0,0,0.8); z-index: 100; border-bottom: 1px solid #333; display: flex; flex-direction: column; align-items: center; justify-content: center; pointer-events: none; }
        #city-name { font-size: 10px; color: #888; text-transform: uppercase; }
        #station-name { font-size: 14px; font-weight: bold; color: #00ff88; }

        /* –õ–æ–∞–¥–µ—Ä */
        #loader { position: fixed; top: 70px; left: 50%; transform: translateX(-50%); background: #00ff88; color: #000; padding: 4px 12px; border-radius: 10px; font-size: 10px; font-weight: bold; display: none; z-index: 90; }

        /* –ì–µ–æ */
        #geo-btn { position: fixed; top: 70px; right: 20px; z-index: 100; background: #222; border: 1px solid #444; border-radius: 50%; width: 44px; height: 44px; display: flex; align-items: center; justify-content: center; cursor: pointer; font-size: 20px; }

        /* –ú–µ–Ω—é */
        #sidebar { position: fixed; top: 0; left: -320px; width: 300px; height: 100%; background: #0d0d0d; z-index: 200; transition: 0.3s; border-right: 1px solid #333; display: flex; flex-direction: column; }
        #sidebar.open { left: 0; }
        .sidebar-header { padding: 70px 20px 10px; }
        #search-input { width: 100%; padding: 12px; background: #1a1a1a; border: 1px solid #333; border-radius: 8px; color: white; box-sizing: border-box; }

        #station-list { flex: 1; overflow-y: auto; padding: 10px; }
        .station-item { padding: 12px; margin-bottom: 8px; background: #161616; border-radius: 10px; cursor: pointer; font-size: 13px; border: 1px solid transparent; }
        .station-item:hover { border-color: #00ff88; }

        /* –ü–ª–µ–µ—Ä */
        #player-bar { position: fixed; bottom: 0; width: 100%; background: #111; padding: 15px; z-index: 150; border-top: 1px solid #333; display: none; box-sizing: border-box; }
        .player-content { display: flex; align-items: center; gap: 12px; max-width: 500px; margin: 0 auto; }
        #volume { flex: 1; accent-color: #00ff88; }
        #timer { font-family: monospace; font-size: 12px; color: #888; }
    </style>
</head>
<body>

    <div id="ui-top">
        <div id="city-name">–í–†–ê–©–ê–ô–¢–ï –ì–õ–û–ë–£–°</div>
        <div id="station-name">RADIO GARDEN API</div>
    </div>

    <div id="loader">–ü–û–ò–°–ö...</div>
    <div id="geo-btn" onclick="locate()">üìç</div>
    <div id="globeViz"></div>

    <div id="sidebar">
        <div class="sidebar-header">
            <input type="text" id="search-input" placeholder="–ü–æ–∏—Å–∫ —Å—Ç–∞–Ω—Ü–∏–∏..." oninput="filterStations()">
        </div>
        <div id="station-list"></div>
    </div>

    <div id="player-bar">
        <div class="player-content">
            <span>üîà</span>
            <input type="range" id="volume" min="0" max="1" step="0.01" value="0.8">
            <div id="timer">00:00</div>
        </div>
    </div>

    <audio id="audio"></audio>

    <script>
        const tg = window.Telegram.WebApp;
        tg.ready(); tg.expand();

        let allCities = []; 
        let currentStations = [];
        let selectedId = null;
        let searchAbort = null;

        const world = Globe()(document.getElementById('globeViz'))
            .globeImageUrl('//unpkg.com/three-globe/example/img/earth-night.jpg')
            .backgroundColor('#000000')
            .showAtmosphere(false)
            // –ò—Å–ø–æ–ª—å–∑—É–µ–º —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π Point Layer (WebGL)
            .pointsData([])
            .pointRadius
